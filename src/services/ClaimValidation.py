import requests
import json
from datetime import datetime

masters = [
    {"accidentDate":"2024-01-14","policyNumber":"028000160641"},
    {"accidentDate":"2024-01-15","policyNumber":"028000240899"},
    {"accidentDate":"2024-01-18","policyNumber":"028000240907"},
    {"accidentDate":"2024-01-30","policyNumber":"028000247229"},
    {"accidentDate":"2024-01-15","policyNumber":"028000252446"},
    {"accidentDate":"2024-01-28","policyNumber":"028005859845"},
    {"accidentDate":"2024-01-18","policyNumber":"028005880870"},
    {"accidentDate":"2024-01-10","policyNumber":"028005894962"},
    {"accidentDate":"2024-01-08","policyNumber":"028005894972"},
    {"accidentDate":"2024-01-14","policyNumber":"028008108880"},
    {"accidentDate":"2024-01-07","policyNumber":"028008120693"},
    {"accidentDate":"2024-01-07","policyNumber":"028008120696"},
    {"accidentDate":"2024-01-08","policyNumber":"028008120721"},
    {"accidentDate":"2024-01-27","policyNumber":"028008121249"},
    {"accidentDate":"2024-01-29","policyNumber":"028008137246"},
    {"accidentDate":"2024-01-09","policyNumber":"028008159826"},
    {"accidentDate":"2024-01-24","policyNumber":"028008160047"},
    {"accidentDate":"2024-01-20","policyNumber":"028008160352"},
    {"accidentDate":"2024-01-29","policyNumber":"028008162486"},
    {"accidentDate":"2024-01-03","policyNumber":"028008199526"},
    {"accidentDate":"2024-01-01","policyNumber":"028008200270"},
    {"accidentDate":"2024-01-23","policyNumber":"028008201337"},
    {"accidentDate":"2024-01-03","policyNumber":"028008241527"},
    {"accidentDate":"2024-01-07","policyNumber":"028008277004"},
    {"accidentDate":"2024-01-10","policyNumber":"028008278789"},
    {"accidentDate":"2024-01-30","policyNumber":"028008280784"},
    {"accidentDate":"2024-01-15","policyNumber":"028008308644"},
    {"accidentDate":"2024-01-23","policyNumber":"028008309073"},
    {"accidentDate":"2024-01-19","policyNumber":"028008339376"},
    {"accidentDate":"2024-01-26","policyNumber":"028008339622"},
    {"accidentDate":"2024-01-22","policyNumber":"028008339665"},
    {"accidentDate":"2024-01-31","policyNumber":"028008340255"},
    {"accidentDate":"2024-01-22","policyNumber":"028008341902"},
    {"accidentDate":"2024-01-16","policyNumber":"028000152895"},
    {"accidentDate":"2024-01-19","policyNumber":"028000174216"},
    {"accidentDate":"2024-01-16","policyNumber":"028000263287"},
    {"accidentDate":"2024-01-01","policyNumber":"028000341515"},
    {"accidentDate":"2024-01-05","policyNumber":"028005816480"},
    {"accidentDate":"2024-01-31","policyNumber":"028005832708"},
    {"accidentDate":"2024-01-20","policyNumber":"028005833040"},
    {"accidentDate":"2024-01-15","policyNumber":"028005859164"},
    {"accidentDate":"2024-01-28","policyNumber":"028005859731"},
    {"accidentDate":"2024-01-14","policyNumber":"028005895140"},
    {"accidentDate":"2024-01-31","policyNumber":"028005895768"},
    {"accidentDate":"2024-01-07","policyNumber":"028008120694"},
    {"accidentDate":"2024-01-20","policyNumber":"028008136700"},
    {"accidentDate":"2024-01-04","policyNumber":"028008159689"},
    {"accidentDate":"2024-01-04","policyNumber":"028008159716"},
    {"accidentDate":"2024-01-11","policyNumber":"028008159890"},
    {"accidentDate":"2024-01-11","policyNumber":"028008159905"},
    {"accidentDate":"2024-01-23","policyNumber":"028008160500"},
    {"accidentDate":"2024-01-26","policyNumber":"028008160601"},
    {"accidentDate":"2024-01-04","policyNumber":"028008199687"},
    {"accidentDate":"2024-01-17","policyNumber":"028008200754"},
    {"accidentDate":"2024-01-23","policyNumber":"028008201444"},
    {"accidentDate":"2024-01-10","policyNumber":"028008241966"},
    {"accidentDate":"2024-01-29","policyNumber":"028008244124"},
    {"accidentDate":"2024-01-07","policyNumber":"028008278304"},
    {"accidentDate":"2024-01-09","policyNumber":"028008278712"},
    {"accidentDate":"2024-01-23","policyNumber":"028008280362"},
    {"accidentDate":"2024-01-27","policyNumber":"028008280387"},
    {"accidentDate":"2024-01-13","policyNumber":"028008308577"},
    {"accidentDate":"2024-01-15","policyNumber":"028008308662"},
    {"accidentDate":"2024-01-27","policyNumber":"028008309510"},
    {"accidentDate":"2024-01-28","policyNumber":"028008309652"},
    {"accidentDate":"2024-01-07","policyNumber":"028008338690"},
    {"accidentDate":"2024-01-05","policyNumber":"028008338761"},
    {"accidentDate":"2024-01-22","policyNumber":"028008341875"},
    {"accidentDate":"2024-01-28","policyNumber":"028000025151"},
    {"accidentDate":"2024-01-11","policyNumber":"028000252338"},
    {"accidentDate":"2024-01-29","policyNumber":"028000341646"},
    {"accidentDate":"2024-01-29","policyNumber":"028005833659"},
    {"accidentDate":"2024-01-09","policyNumber":"028005858689"},
    {"accidentDate":"2024-01-18","policyNumber":"028005859173"},
    {"accidentDate":"2024-01-13","policyNumber":"028005880665"},
    {"accidentDate":"2024-01-31","policyNumber":"028005881611"},
    {"accidentDate":"2024-01-15","policyNumber":"028005895165"},
    {"accidentDate":"2024-01-15","policyNumber":"028008108427"},
    {"accidentDate":"2024-01-14","policyNumber":"028008109014"},
    {"accidentDate":"2024-01-22","policyNumber":"028008120746"},
    {"accidentDate":"2024-01-26","policyNumber":"028008120865"},
    {"accidentDate":"2024-01-22","policyNumber":"028008120911"},
    {"accidentDate":"2024-01-27","policyNumber":"028008121126"},
    {"accidentDate":"2024-01-04","policyNumber":"028008135929"},
    {"accidentDate":"2024-01-08","policyNumber":"028008136169"},
    {"accidentDate":"2024-01-08","policyNumber":"028008136174"},
    {"accidentDate":"2024-01-27","policyNumber":"028008136915"},
    {"accidentDate":"2024-01-31","policyNumber":"028008137327"},
    {"accidentDate":"2024-01-01","policyNumber":"028008159621"},
    {"accidentDate":"2024-01-26","policyNumber":"028008160724"},
    {"accidentDate":"2024-01-30","policyNumber":"028008160891"},
    {"accidentDate":"2024-01-05","policyNumber":"028008201543"},
    {"accidentDate":"2024-01-25","policyNumber":"028008201696"},
    {"accidentDate":"2024-01-15","policyNumber":"028008242281"},
    {"accidentDate":"2024-01-21","policyNumber":"028008242987"},
    {"accidentDate":"2024-01-24","policyNumber":"028008246884"},
    {"accidentDate":"2024-01-01","policyNumber":"028008277810"},
    {"accidentDate":"2024-01-21","policyNumber":"028008279841"},
    {"accidentDate":"2024-01-22","policyNumber":"028008279943"},
    {"accidentDate":"2024-01-23","policyNumber":"028008280077"},
    {"accidentDate":"2024-01-28","policyNumber":"028008280524"},
    {"accidentDate":"2024-01-28","policyNumber":"028008280600"},
    {"accidentDate":"2024-01-29","policyNumber":"028008280662"},
    {"accidentDate":"2024-01-01","policyNumber":"028008307897"},
    {"accidentDate":"2024-01-08","policyNumber":"028008308288"},
    {"accidentDate":"2024-01-26","policyNumber":"028008309326"},
    {"accidentDate":"2024-01-26","policyNumber":"028008309351"},
    {"accidentDate":"2024-01-27","policyNumber":"028008309509"},
    {"accidentDate":"2024-01-08","policyNumber":"028008338063"},
    {"accidentDate":"2024-01-14","policyNumber":"028008339142"},
    {"accidentDate":"2024-01-22","policyNumber":"028008341826"},
    {"accidentDate":"2024-01-10","policyNumber":"028000168046"},
    {"accidentDate":"2024-01-28","policyNumber":"028000179575"},
    {"accidentDate":"2024-01-18","policyNumber":"028001033218"},
    {"accidentDate":"2024-01-22","policyNumber":"028005817174"},
    {"accidentDate":"2024-01-31","policyNumber":"028005860012"},
    {"accidentDate":"2024-01-27","policyNumber":"028005881296"},
    {"accidentDate":"2024-01-16","policyNumber":"028008120927"},
    {"accidentDate":"2024-01-28","policyNumber":"028008121268"},
    {"accidentDate":"2024-01-07","policyNumber":"028008136147"},
    {"accidentDate":"2024-01-13","policyNumber":"028008136339"},
    {"accidentDate":"2024-01-27","policyNumber":"028008136912"},
    {"accidentDate":"2024-01-29","policyNumber":"028008137310"},
    {"accidentDate":"2024-01-12","policyNumber":"028008159950"},
    {"accidentDate":"2024-01-04","policyNumber":"028008199618"},
    {"accidentDate":"2024-01-04","policyNumber":"028008199667"},
    {"accidentDate":"2024-01-10","policyNumber":"028008199996"},
    {"accidentDate":"2024-01-15","policyNumber":"028008200370"},
    {"accidentDate":"2024-01-25","policyNumber":"028008201737"},
    {"accidentDate":"2024-01-09","policyNumber":"028008241784"},
    {"accidentDate":"2024-01-17","policyNumber":"028008242602"},
    {"accidentDate":"2024-01-01","policyNumber":"028008277011"},
    {"accidentDate":"2024-01-02","policyNumber":"028008278185"},
    {"accidentDate":"2024-01-09","policyNumber":"028008278707"},
    {"accidentDate":"2024-01-22","policyNumber":"028008279980"},
    {"accidentDate":"2024-01-15","policyNumber":"028008280446"},
    {"accidentDate":"2024-01-05","policyNumber":"028008308023"},
    {"accidentDate":"2024-01-28","policyNumber":"028008308679"},
    {"accidentDate":"2024-01-20","policyNumber":"028008308948"},
    {"accidentDate":"2024-01-26","policyNumber":"028008309299"},
    {"accidentDate":"2024-01-04","policyNumber":"028008338449"},
    {"accidentDate":"2024-01-05","policyNumber":"028008338527"},
    {"accidentDate":"2024-01-12","policyNumber":"028008338876"},
    {"accidentDate":"2024-01-13","policyNumber":"028008341449"},
    {"accidentDate":"2024-01-22","policyNumber":"028008341878"},
    {"accidentDate":"2024-01-15","policyNumber":"028000240652"},
    {"accidentDate":"2024-01-15","policyNumber":"028000240901"},
    {"accidentDate":"2024-01-01","policyNumber":"028000258516"},
    {"accidentDate":"2024-01-05","policyNumber":"028005810454"},
    {"accidentDate":"2024-01-23","policyNumber":"028005817107"},
    {"accidentDate":"2024-01-30","policyNumber":"028005817204"},
    {"accidentDate":"2024-01-07","policyNumber":"028005832443"},
    {"accidentDate":"2024-01-26","policyNumber":"028005881227"},
    {"accidentDate":"2024-01-10","policyNumber":"028005895073"},
    {"accidentDate":"2024-01-11","policyNumber":"028005895092"},
    {"accidentDate":"2024-01-11","policyNumber":"028005895119"},
    {"accidentDate":"2024-01-31","policyNumber":"028005895721"},
    {"accidentDate":"2024-01-15","policyNumber":"028008109031"},
    {"accidentDate":"2024-01-27","policyNumber":"028008109614"},
    {"accidentDate":"2024-01-15","policyNumber":"028008120898"},
    {"accidentDate":"2024-01-16","policyNumber":"028008120929"},
    {"accidentDate":"2024-01-12","policyNumber":"028008136539"},
    {"accidentDate":"2024-01-16","policyNumber":"028008153819"},
    {"accidentDate":"2024-01-16","policyNumber":"028008160102"},
    {"accidentDate":"2024-01-05","policyNumber":"028008199717"},
    {"accidentDate":"2024-01-01","policyNumber":"028008200261"},
    {"accidentDate":"2024-01-17","policyNumber":"028008232975"},
    {"accidentDate":"2024-01-03","policyNumber":"028008240818"},
    {"accidentDate":"2024-01-25","policyNumber":"028008241500"},
    {"accidentDate":"2024-01-26","policyNumber":"028008241913"},
    {"accidentDate":"2024-01-21","policyNumber":"028008243054"},
    {"accidentDate":"2024-01-17","policyNumber":"028008278758"},
    {"accidentDate":"2024-01-04","policyNumber":"028008307976"},
    {"accidentDate":"2024-01-01","policyNumber":"028008308430"},
    {"accidentDate":"2024-01-21","policyNumber":"028008309056"},
    {"accidentDate":"2024-01-29","policyNumber":"028008309140"},
    {"accidentDate":"2024-01-13","policyNumber":"028008338994"},
    {"accidentDate":"2024-01-18","policyNumber":"028008339343"},
    {"accidentDate":"2024-01-21","policyNumber":"028008339631"},
    {"accidentDate":"2024-01-24","policyNumber":"028000181988"},
    {"accidentDate":"2024-01-15","policyNumber":"028000240107"},
    {"accidentDate":"2024-01-05","policyNumber":"028000252368"},
    {"accidentDate":"2024-01-02","policyNumber":"028005818133"},
    {"accidentDate":"2024-01-20","policyNumber":"028005832974"},
    {"accidentDate":"2024-01-21","policyNumber":"028005833183"},
    {"accidentDate":"2024-01-27","policyNumber":"028005881476"},
    {"accidentDate":"2024-01-31","policyNumber":"028005881600"},
    {"accidentDate":"2024-01-11","policyNumber":"028005895100"},
    {"accidentDate":"2024-01-31","policyNumber":"028005895732"},
    {"accidentDate":"2024-01-16","policyNumber":"028008109123"},
    {"accidentDate":"2024-01-22","policyNumber":"028008109423"},
    {"accidentDate":"2024-01-22","policyNumber":"028008121123"},
    {"accidentDate":"2024-01-07","policyNumber":"028008136124"},
    {"accidentDate":"2024-01-25","policyNumber":"028008136931"},
    {"accidentDate":"2024-01-07","policyNumber":"028008159818"},
    {"accidentDate":"2024-01-13","policyNumber":"028008159981"},
    {"accidentDate":"2024-01-27","policyNumber":"028008160780"},
    {"accidentDate":"2024-01-31","policyNumber":"028008161050"},
    {"accidentDate":"2024-01-09","policyNumber":"028008199835"},
    {"accidentDate":"2024-01-24","policyNumber":"028008201437"},
    {"accidentDate":"2024-01-31","policyNumber":"028008202344"},
    {"accidentDate":"2024-01-18","policyNumber":"028008242759"},
    {"accidentDate":"2024-01-22","policyNumber":"028008249482"},
    {"accidentDate":"2024-01-09","policyNumber":"028008278642"},
    {"accidentDate":"2024-01-10","policyNumber":"028008278784"},
    {"accidentDate":"2024-01-24","policyNumber":"028008280265"},
    {"accidentDate":"2024-01-29","policyNumber":"028008280764"},
    {"accidentDate":"2024-01-21","policyNumber":"028008281824"},
    {"accidentDate":"2024-01-15","policyNumber":"028008308628"},
    {"accidentDate":"2024-01-15","policyNumber":"028008308635"},
    {"accidentDate":"2024-01-18","policyNumber":"028008308779"},
    {"accidentDate":"2024-01-25","policyNumber":"028008309259"},
    {"accidentDate":"2024-01-27","policyNumber":"028008309513"},
    {"accidentDate":"2024-01-05","policyNumber":"028008338558"},
    {"accidentDate":"2024-01-24","policyNumber":"028008339696"},
    {"accidentDate":"2024-01-21","policyNumber":"028000113805"},
    {"accidentDate":"2024-01-26","policyNumber":"028000168455"},
    {"accidentDate":"2024-01-07","policyNumber":"028000246955"},
    {"accidentDate":"2024-01-28","policyNumber":"028005817302"},
    {"accidentDate":"2024-01-16","policyNumber":"028005820114"},
    {"accidentDate":"2024-01-19","policyNumber":"028005832863"},
    {"accidentDate":"2024-01-27","policyNumber":"028005833467"},
    {"accidentDate":"2024-01-31","policyNumber":"028005882001"},
    {"accidentDate":"2024-01-09","policyNumber":"028005895008"},
    {"accidentDate":"2024-01-11","policyNumber":"028005895107"},
    {"accidentDate":"2024-01-10","policyNumber":"028008108875"},
    {"accidentDate":"2024-01-23","policyNumber":"028008120962"},
    {"accidentDate":"2024-01-21","policyNumber":"028008136772"},
    {"accidentDate":"2024-01-13","policyNumber":"028008159984"},
    {"accidentDate":"2024-01-12","policyNumber":"028008200257"},
    {"accidentDate":"2024-01-12","policyNumber":"028008200306"},
    {"accidentDate":"2024-01-24","policyNumber":"028008201061"},
    {"accidentDate":"2024-01-23","policyNumber":"028008201358"},
    {"accidentDate":"2024-01-31","policyNumber":"028008202252"},
    {"accidentDate":"2024-01-04","policyNumber":"028008241550"},
    {"accidentDate":"2024-01-10","policyNumber":"028008241944"},
    {"accidentDate":"2024-01-09","policyNumber":"028008278574"},
    {"accidentDate":"2024-01-17","policyNumber":"028008279514"},
    {"accidentDate":"2024-01-23","policyNumber":"028008280046"},
    {"accidentDate":"2024-01-29","policyNumber":"028008280667"},
    {"accidentDate":"2024-01-31","policyNumber":"028008280938"},
    {"accidentDate":"2024-01-30","policyNumber":"028008281585"},
    {"accidentDate":"2024-01-16","policyNumber":"028008308724"},
    {"accidentDate":"2024-01-23","policyNumber":"028008309079"},
    {"accidentDate":"2024-01-26","policyNumber":"028008309406"},
    {"accidentDate":"2024-01-06","policyNumber":"028008338655"},
    {"accidentDate":"2024-01-24","policyNumber":"028008339713"},
    {"accidentDate":"2024-01-28","policyNumber":"028008340129"},
    {"accidentDate":"2024-01-20","policyNumber":"028000139435"},
    {"accidentDate":"2024-01-05","policyNumber":"028005816502"},
    {"accidentDate":"2024-01-01","policyNumber":"028005858405"},
    {"accidentDate":"2024-01-04","policyNumber":"028005858803"},
    {"accidentDate":"2024-01-04","policyNumber":"028005880504"},
    {"accidentDate":"2024-01-18","policyNumber":"028005880930"},
    {"accidentDate":"2024-01-16","policyNumber":"028005881076"},
    {"accidentDate":"2024-01-11","policyNumber":"028005895110"},
    {"accidentDate":"2024-01-13","policyNumber":"028008108930"},
    {"accidentDate":"2024-01-13","policyNumber":"028008120818"},
    {"accidentDate":"2024-01-26","policyNumber":"028008121220"},
    {"accidentDate":"2024-01-08","policyNumber":"028008136164"},
    {"accidentDate":"2024-01-25","policyNumber":"028008137033"},
    {"accidentDate":"2024-01-06","policyNumber":"028008159773"},
    {"accidentDate":"2024-01-25","policyNumber":"028008199490"},
    {"accidentDate":"2024-01-11","policyNumber":"028008200120"},
    {"accidentDate":"2024-01-18","policyNumber":"028008200855"},
    {"accidentDate":"2024-01-31","policyNumber":"028008201817"},
    {"accidentDate":"2024-01-04","policyNumber":"028008241591"},
    {"accidentDate":"2024-01-09","policyNumber":"028008241777"},
    {"accidentDate":"2024-01-14","policyNumber":"028008242255"},
    {"accidentDate":"2024-01-15","policyNumber":"028008242349"},
    {"accidentDate":"2024-01-24","policyNumber":"028008242419"},
    {"accidentDate":"2024-01-18","policyNumber":"028008242783"},
    {"accidentDate":"2024-01-25","policyNumber":"028008243461"},
    {"accidentDate":"2024-01-29","policyNumber":"028008243904"},
    {"accidentDate":"2024-01-07","policyNumber":"028008278311"},
    {"accidentDate":"2024-01-09","policyNumber":"028008278708"},
    {"accidentDate":"2024-01-17","policyNumber":"028008279477"},
    {"accidentDate":"2024-01-22","policyNumber":"028008279966"},
    {"accidentDate":"2024-01-02","policyNumber":"028008307901"},
    {"accidentDate":"2024-01-27","policyNumber":"028008309566"},
    {"accidentDate":"2024-01-28","policyNumber":"028008309668"},
    {"accidentDate":"2024-01-29","policyNumber":"028008309857"},
    {"accidentDate":"2024-01-29","policyNumber":"028008310687"},
    {"accidentDate":"2024-01-12","policyNumber":"028008338907"},
    {"accidentDate":"2024-01-15","policyNumber":"028008339077"},
    {"accidentDate":"2024-01-17","policyNumber":"028008339239"},
    {"accidentDate":"2024-01-19","policyNumber":"028008339433"},
    {"accidentDate":"2024-01-26","policyNumber":"028008339912"},
    {"accidentDate":"2024-01-12","policyNumber":"028008340649"},
    {"accidentDate":"2024-01-22","policyNumber":"028008341876"},
    {"accidentDate":"2024-01-22","policyNumber":"028008341877"}
]

def get_accidents(policy_number):
    url = "https://coreseguros.suramericana.com/cc/service/edge/sura/claim"
    headers = {
        "Authorization": "Basic dXNlckNsaWVudFdTR0M6UTJ4cFpXNTBWMU5IUXkx",
        "Content-Type": "application/json"
    }
    cookies = {
        "dtCookie": "v_4_srv_4_sn_EF135D188AA3667EA1A21C2DB7F67191_perc_100000_ol_0_mul_1_app-3A88102dc26bfdf125_1_app-3A5c7c7ec06c7df59e_1_app-3A73d9ef51da4cb7de_1_rcs-3Acss_1",
        "visid_incap_2433063": "iPKazSLuSbW9YJBRZixtUX0vwWUAAAAAQUIPAAAAAAAqSDWCjuKI3xLw07H92mLo",
        "incap_ses_1603_2433063": "YHCrIWnoSD61pRwGLgA%2FFrq28mYAAAAABt2%2Fa1suNm%2FBvTOkHzSubg%3D%3D"
    }
    data = {
        "id": "",
        "method": "claimSearch",
        "productLine": "CommercialPackage",
        "params": [
            {
                "policyNumber": policy_number,
                "riskPolicyNumber": ""
            }
        ],
        "volume": "low",
        "jsonrpc": "2.0"
    }

    response = requests.post(url, headers=headers, cookies=cookies, data=json.dumps(data))

    if response.status_code == 200:
        return response.json()
    else:
        response.raise_for_status()

def validate_loss_date(resultado, date):
    elementos_validos = []

    for item in resultado.get('result', []):
        loss_date_str = item.get('lossDate')
        if loss_date_str:
            loss_date_dt = datetime.strptime(loss_date_str, "%Y-%m-%dT%H:%M:%SZ")
            if loss_date_dt >= date:
                #print(f"{loss_date_dt} es mayor o igual a {date}")
                elementos_validos.append(loss_date_str)

    return elementos_validos

def validate_master_list(policies):
    for policy in policies:
        policy_number = policy.get('policyNumber')
        accident_date = policy.get('accidentDate') + 'T05:01:00Z'

        date =  datetime.strptime(accident_date, "%Y-%m-%dT%H:%M:%SZ")
        accidents = get_accidents(policy_number)
        valid_elements = validate_loss_date(accidents, date)
        if len(valid_elements) > 0:
            print(f"Master: {policy_number}, Siniestros: {valid_elements}, Cantidad: {len(valid_elements)}")


validate_master_list(masters)


